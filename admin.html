<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="robots" content="noindex,nofollow"/>
  <title>Admin â€” Peopole AI</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <style>
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
  :root{
    --navy:#0b1629;--navy2:#111f3a;--navy3:#172544;
    --gold:#d4a843;--gold2:#f0c96a;--goldglow:rgba(212,168,67,.1);
    --teal:#1ec8b0;--rose:#e05c7a;--blue:#3b82f6;--purple:#8b5cf6;
    --text:#e8edf5;--text2:#8fa3c0;--text3:#3a4a62;
    --border:rgba(255,255,255,.07);--border2:rgba(255,255,255,.12);
    --r:12px;--font-d:'Playfair Display',serif;--font-b:'Outfit',sans-serif;
  }
  html,body{height:100%;background:var(--navy);color:var(--text);font-family:var(--font-b);font-size:14px;overflow:hidden}
  ::-webkit-scrollbar{width:4px;height:4px}
  ::-webkit-scrollbar-thumb{background:rgba(212,168,67,.2);border-radius:99px}

  /* â•â• LOGIN â•â• */
  #loginScreen{
    position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
    padding:20px;z-index:999;
    background:radial-gradient(ellipse at 70% 20%,rgba(212,168,67,.06),transparent 60%),var(--navy);
  }
  .login-box{
    width:100%;max-width:360px;
    background:var(--navy2);border:1px solid rgba(212,168,67,.3);
    border-radius:20px;padding:38px 32px;
    box-shadow:0 40px 100px rgba(0,0,0,.5),0 0 80px var(--goldglow);
    animation:popUp .4s cubic-bezier(.34,1.56,.64,1);
  }
  @keyframes popUp{from{opacity:0;transform:translateY(24px) scale(.97)}to{opacity:1;transform:none}}
  .login-logo{width:52px;height:52px;border-radius:12px;overflow:hidden;background:#fff;margin:0 auto 16px;box-shadow:0 4px 16px rgba(0,0,0,.3)}
  .login-logo img{width:100%;height:100%;object-fit:cover}
  .login-box h2{font-family:var(--font-d);font-size:20px;text-align:center;color:#fff;margin-bottom:3px}
  .login-box p{font-size:12px;color:var(--text2);text-align:center;margin-bottom:26px}
  .lf{margin-bottom:12px}
  .lf label{display:block;font-size:11px;color:var(--text2);font-weight:600;letter-spacing:.5px;margin-bottom:6px}
  .lf input{
    width:100%;padding:11px 14px;background:var(--navy3);
    border:1px solid var(--border2);border-radius:10px;
    color:var(--text);font-family:var(--font-b);font-size:14px;outline:none;
    transition:border-color .2s;
  }
  .lf input:focus{border-color:var(--gold)}
  .login-btn{
    width:100%;padding:12px;margin-top:8px;
    background:linear-gradient(135deg,var(--gold),var(--gold2));
    border:none;border-radius:10px;color:#0b1629;
    font-family:var(--font-b);font-size:14px;font-weight:700;cursor:pointer;
    transition:opacity .2s;
  }
  .login-btn:hover{opacity:.88}
  .login-err{display:none;margin-top:10px;font-size:12px;color:var(--rose);text-align:center}

  /* â•â• LAYOUT â•â• */
  #dashboard{display:none;height:100vh;overflow:hidden}
  .layout{display:flex;height:100%}

  /* â•â• SIDEBAR â•â• */
  .sidebar{
    width:210px;min-width:210px;height:100%;
    background:var(--navy2);border-right:1px solid var(--border);
    display:flex;flex-direction:column;overflow-y:auto;flex-shrink:0;
  }
  .sb-brand{padding:18px 16px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px}
  .sb-logo{width:34px;height:34px;border-radius:8px;overflow:hidden;background:#fff;flex-shrink:0}
  .sb-logo img{width:100%;height:100%;object-fit:cover}
  .sb-name{font-family:var(--font-d);font-size:13px;font-weight:700;color:var(--gold2);line-height:1.2}
  .sb-sub{font-size:10px;color:var(--text2)}
  .sb-nav{flex:1;padding:12px 8px}
  .sb-section{font-size:10px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);padding:0 8px;margin:14px 0 5px}
  .sb-section:first-child{margin-top:0}
  .nav-btn{
    display:flex;align-items:center;gap:9px;width:100%;
    padding:9px 10px;border-radius:9px;border:none;
    background:none;color:var(--text2);font-family:var(--font-b);
    font-size:13px;cursor:pointer;transition:all .15s;margin-bottom:2px;
    text-decoration:none;text-align:left;
  }
  .nav-btn:hover{background:var(--navy3);color:var(--text)}
  .nav-btn.active{background:var(--goldglow);color:var(--gold2);border:1px solid rgba(212,168,67,.2)}
  .nav-btn svg,.nav-btn .nb-icon{opacity:.55}
  .nav-btn.active svg,.nav-btn.active .nb-icon{opacity:1}
  .sb-footer{padding:12px 10px;border-top:1px solid var(--border)}
  .logout-btn{
    width:100%;padding:9px;border-radius:9px;border:1px solid var(--border2);
    background:none;color:var(--text2);font-family:var(--font-b);font-size:12px;
    cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:7px;
  }
  .logout-btn:hover{border-color:var(--rose);color:var(--rose)}

  /* â•â• MAIN â•â• */
  .main{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0}
  .topbar{
    height:54px;display:flex;align-items:center;gap:12px;
    padding:0 22px;border-bottom:1px solid var(--border);
    background:rgba(11,22,41,.9);backdrop-filter:blur(12px);flex-shrink:0;
  }
  .topbar-title{font-family:var(--font-d);font-size:15px;font-weight:700;color:#fff;flex:1}
  .topbar-actions{display:flex;align-items:center;gap:8px}
  .live-dot{display:flex;align-items:center;gap:5px;font-size:11px;color:var(--teal);padding:4px 10px;border-radius:99px;background:rgba(30,200,176,.1);border:1px solid rgba(30,200,176,.2)}
  .live-dot::before{content:'';width:6px;height:6px;border-radius:50%;background:var(--teal);animation:pulse 2s infinite}
  @keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(30,200,176,.4)}50%{box-shadow:0 0 0 5px rgba(30,200,176,0)}}
  .top-btn{
    padding:7px 13px;border-radius:9px;border:1px solid var(--border2);
    background:none;color:var(--text2);font-family:var(--font-b);font-size:12px;
    cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:5px;
  }
  .top-btn:hover{border-color:rgba(212,168,67,.4);color:var(--gold)}
  .top-btn.danger{border-color:rgba(224,92,122,.25);color:var(--rose)}
  .top-btn.danger:hover{border-color:var(--rose);background:rgba(224,92,122,.08)}
  .content{flex:1;overflow-y:auto;padding:22px}

  /* â•â• STAT CARDS â•â• */
  .stat-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:13px;margin-bottom:20px}
  .stat-card{
    background:var(--navy2);border:1px solid var(--border);border-radius:var(--r);
    padding:17px 18px;transition:border-color .2s;position:relative;overflow:hidden;
  }
  .stat-card::after{content:'';position:absolute;top:0;left:0;right:0;height:3px}
  .stat-card.gold::after{background:linear-gradient(90deg,var(--gold),var(--gold2))}
  .stat-card.teal::after{background:var(--teal)}
  .stat-card.blue::after{background:var(--blue)}
  .stat-card.rose::after{background:var(--rose)}
  .stat-card:hover{border-color:rgba(212,168,67,.25)}
  .sc-label{font-size:11px;color:var(--text2);font-weight:500;margin-bottom:8px;display:flex;align-items:center;gap:5px}
  .sc-value{font-family:var(--font-d);font-size:30px;font-weight:700;color:#fff;line-height:1}
  .sc-sub{font-size:11px;color:var(--text2);margin-top:4px}

  /* â•â• QUICK ACTIONS â•â• */
  .qa-row{display:grid;grid-template-columns:repeat(3,1fr);gap:13px;margin-bottom:20px}
  .qa-card{
    background:var(--navy2);border:1px solid var(--border);border-radius:var(--r);
    padding:15px 18px;display:flex;align-items:center;gap:13px;
    text-decoration:none;color:var(--text);transition:all .2s;cursor:pointer;
  }
  .qa-card:hover{border-color:rgba(212,168,67,.3);transform:translateY(-1px)}
  .qa-icon{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
  .qa-icon.g{background:rgba(37,211,102,.12)} .qa-icon.y{background:var(--goldglow)} .qa-icon.b{background:rgba(59,130,246,.1)}
  .qa-title{font-size:13px;font-weight:600;color:#fff} .qa-desc{font-size:11px;color:var(--text2)}

  /* â•â• CHARTS â•â• */
  .chart-row{display:grid;grid-template-columns:2fr 1fr;gap:13px;margin-bottom:20px}
  .chart-card{background:var(--navy2);border:1px solid var(--border);border-radius:var(--r);padding:18px 20px}
  .chart-card h3{font-family:var(--font-d);font-size:13px;font-weight:700;color:#fff;margin-bottom:14px}
  .bar-wrap{display:flex;align-items:flex-end;gap:3px;height:90px;border-bottom:1px solid var(--border);position:relative}
  .bar-item{flex:1;display:flex;flex-direction:column;justify-content:flex-end;align-items:center;gap:0;position:relative;cursor:default}
  .bar-fill{
    width:100%;border-radius:3px 3px 0 0;min-height:2px;
    background:linear-gradient(180deg,var(--gold) 0%,rgba(212,168,67,.35) 100%);
    transition:opacity .2s;position:relative;
  }
  .bar-fill:hover{opacity:.75}
  .bar-tip{
    position:absolute;bottom:calc(100% + 5px);left:50%;transform:translateX(-50%);
    background:var(--navy3);border:1px solid var(--border2);border-radius:6px;
    padding:3px 8px;font-size:10px;white-space:nowrap;pointer-events:none;
    opacity:0;transition:opacity .15s;z-index:5;
  }
  .bar-item:hover .bar-tip{opacity:1}
  .bar-labels{display:flex;gap:3px;margin-top:6px}
  .bar-lbl{flex:1;text-align:center;font-size:9px;color:var(--text3)}
  .stage-item{display:flex;align-items:center;gap:9px;margin-bottom:9px}
  .stage-item:last-child{margin-bottom:0}
  .si-name{font-size:12px;color:var(--text2);width:125px;flex-shrink:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
  .si-bar{flex:1;height:5px;background:rgba(255,255,255,.06);border-radius:99px;overflow:hidden}
  .si-fill{height:100%;border-radius:99px;background:linear-gradient(90deg,var(--gold),var(--gold2));transition:width .7s cubic-bezier(.4,0,.2,1)}
  .si-count{font-size:12px;font-weight:600;color:var(--gold2);width:26px;text-align:right;flex-shrink:0}

  /* â•â• INQUIRY TABLE â•â• */
  .inq-section{background:var(--navy2);border:1px solid var(--border);border-radius:var(--r);padding:18px 20px}
  .inq-header{display:flex;align-items:center;flex-wrap:wrap;gap:10px;margin-bottom:14px}
  .inq-header h3{font-family:var(--font-d);font-size:13px;font-weight:700;color:#fff;flex:1}
  .flt-select{
    padding:7px 10px;background:var(--navy3);border:1px solid var(--border2);
    border-radius:9px;color:var(--text);font-family:var(--font-b);font-size:12px;outline:none;cursor:pointer;
  }
  .flt-select:focus{border-color:var(--gold)}
  .inq-table{width:100%;border-collapse:collapse;font-size:13px}
  .inq-table th{
    padding:8px 12px;text-align:left;
    background:rgba(255,255,255,.03);color:var(--text2);
    font-weight:500;font-size:11px;border-bottom:1px solid var(--border);
    letter-spacing:.5px;
  }
  .inq-table td{padding:11px 12px;border-bottom:1px solid rgba(255,255,255,.04);vertical-align:top}
  .inq-table tr:last-child td{border-bottom:none}
  .inq-table tr:hover td{background:rgba(255,255,255,.02)}
  .msg-preview{color:var(--text);line-height:1.5;max-width:340px}
  .msg-id{font-size:10px;color:var(--text3);margin-top:2px}
  .stg-pill{
    display:inline-flex;align-items:center;gap:4px;padding:3px 9px;border-radius:99px;
    font-size:11px;font-weight:600;background:var(--goldglow);
    color:var(--gold2);border:1px solid rgba(212,168,67,.2);white-space:nowrap;
  }
  .lang-pill{
    padding:3px 8px;border-radius:99px;font-size:10px;font-weight:700;
    background:rgba(30,200,176,.1);color:var(--teal);border:1px solid rgba(30,200,176,.2);
  }
  .lang-pill.bn{background:rgba(139,92,246,.1);color:#a78bfa;border-color:rgba(139,92,246,.2)}
  .time-col{color:var(--text2);font-size:11px;white-space:nowrap}
  .empty-cell{text-align:center;padding:36px;color:var(--text2);font-style:italic}
  .pagination{display:flex;justify-content:center;gap:5px;margin-top:14px;flex-wrap:wrap}
  .pg-btn{
    padding:6px 12px;border-radius:8px;border:1px solid var(--border2);
    background:none;color:var(--text2);font-family:var(--font-b);font-size:12px;cursor:pointer;transition:all .2s;
  }
  .pg-btn:hover,.pg-btn.active{border-color:var(--gold);color:var(--gold);background:var(--goldglow)}
  .pg-btn:disabled{opacity:.3;cursor:not-allowed;pointer-events:none}

  /* â•â• LOADING â•â• */
  .loader{display:flex;align-items:center;justify-content:center;padding:32px;color:var(--text2)}
  .spin{width:18px;height:18px;border:2px solid var(--border2);border-top-color:var(--gold);border-radius:50%;animation:sp .7s linear infinite;margin-right:8px}
  @keyframes sp{to{transform:rotate(360deg)}}

  /* â•â• TOAST â•â• */
  #toast{
    position:fixed;bottom:22px;left:50%;transform:translateX(-50%);
    background:var(--navy3);color:var(--text);padding:10px 20px;
    border-radius:10px;border:1px solid var(--border2);
    box-shadow:0 4px 20px rgba(0,0,0,.4);font-size:13px;
    z-index:9999;display:none;animation:fadeUp .3s ease;
  }
  @keyframes fadeUp{from{opacity:0;transform:translate(-50%,8px)}to{opacity:1;transform:translateX(-50%)}}

  @media(max-width:900px){.stat-grid{grid-template-columns:1fr 1fr}.chart-row{grid-template-columns:1fr}.qa-row{grid-template-columns:1fr 1fr}}
  @media(max-width:640px){.sidebar{display:none}.stat-grid{grid-template-columns:1fr 1fr}.qa-row{grid-template-columns:1fr}}
  </style>
</head>
<body>

<!-- â•â• LOGIN â•â• -->
<div id="loginScreen">
  <div class="login-box">
    <div class="login-logo"><img src="/logo.jpg" alt="Logo"/></div>
    <h2>Admin Dashboard</h2>
    <p>Earth Solutions Visa Zone Â· Restricted</p>
    <div class="lf">
      <label>PASSWORD</label>
      <input type="password" id="pwInput" placeholder="Enter admin password" onkeydown="if(event.key==='Enter')doLogin()"/>
    </div>
    <button class="login-btn" onclick="doLogin()">Sign In â†’</button>
    <div class="login-err" id="loginErr">âš ï¸ Incorrect password.</div>
  </div>
</div>

<!-- â•â• DASHBOARD â•â• -->
<div id="dashboard">
  <div class="layout">

    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sb-brand">
        <div class="sb-logo"><img src="/logo.jpg" alt=""/></div>
        <div><div class="sb-name">Peopole AI</div><div class="sb-sub">Admin Panel</div></div>
      </div>
      <nav class="sb-nav">
        <div class="sb-section">Overview</div>
        <button class="nav-btn active" onclick="switchTab('overview',this)">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
          Overview
        </button>
        <div class="sb-section">Data</div>
        <button class="nav-btn" onclick="switchTab('inquiries',this)">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
          Inquiries
        </button>
        <div class="sb-section">Links</div>
        <a class="nav-btn" href="/" target="_blank">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
          Chat App
        </a>
        <a class="nav-btn" href="/pricing.html" target="_blank">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
          Pricing Page
        </a>
        <a class="nav-btn" href="https://wa.me/8801535778111" target="_blank">
          <span class="nb-icon">ğŸ’¬</span> WhatsApp
        </a>
      </nav>
      <div class="sb-footer">
        <button class="logout-btn" onclick="doLogout()">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
          Sign Out
        </button>
      </div>
    </aside>

    <!-- Main content -->
    <div class="main">
      <div class="topbar">
        <div class="topbar-title" id="topbarTitle">Overview</div>
        <div class="topbar-actions">
          <div class="live-dot">Live</div>
          <button class="top-btn" onclick="refreshAll()">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
            Refresh
          </button>
          <button class="top-btn danger" onclick="doReset()">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
            Reset Data
          </button>
        </div>
      </div>

      <div class="content">

        <!-- â”€â”€ OVERVIEW â”€â”€ -->
        <div id="tabOverview">
          <!-- Stat cards -->
          <div class="stat-grid">
            <div class="stat-card gold"><div class="sc-label">ğŸ“Š Total Inquiries</div><div class="sc-value" id="sTotal">â€”</div><div class="sc-sub">All time</div></div>
            <div class="stat-card teal"><div class="sc-label">ğŸ“… Today</div><div class="sc-value" id="sToday">â€”</div><div class="sc-sub">New today</div></div>
            <div class="stat-card blue"><div class="sc-label">ğŸ‡¬ğŸ‡§ English Users</div><div class="sc-value" id="sEn">â€”</div><div class="sc-sub">EN language</div></div>
            <div class="stat-card rose"><div class="sc-label">ğŸ‡§ğŸ‡© à¦¬à¦¾à¦‚à¦²à¦¾ Users</div><div class="sc-value" id="sBn">â€”</div><div class="sc-sub">BN language</div></div>
          </div>

          <!-- Quick actions -->
          <div class="qa-row">
            <a class="qa-card" href="https://wa.me/8801535778111" target="_blank">
              <div class="qa-icon g">ğŸ’¬</div>
              <div><div class="qa-title">WhatsApp</div><div class="qa-desc">+880 1535-778111</div></div>
            </a>
            <a class="qa-card" href="/" target="_blank">
              <div class="qa-icon y">ğŸ¤–</div>
              <div><div class="qa-title">Live Chat App</div><div class="qa-desc">Open Peopole AI</div></div>
            </a>
            <a class="qa-card" href="/pricing.html" target="_blank">
              <div class="qa-icon b">ğŸ“‹</div>
              <div><div class="qa-title">Pricing Page</div><div class="qa-desc">Service plans</div></div>
            </a>
          </div>

          <!-- Charts -->
          <div class="chart-row">
            <div class="chart-card">
              <h3>ğŸ“ˆ Daily Inquiries â€” Last 14 Days</h3>
              <div class="bar-wrap" id="barWrap"><div class="loader"><div class="spin"></div>Loading...</div></div>
              <div class="bar-labels" id="barLabels"></div>
            </div>
            <div class="chart-card">
              <h3>ğŸ“ Top Stages</h3>
              <div id="stageList"><div class="loader"><div class="spin"></div>Loading...</div></div>
            </div>
          </div>
        </div>

        <!-- â”€â”€ INQUIRIES â”€â”€ -->
        <div id="tabInquiries" style="display:none">
          <div class="inq-section">
            <div class="inq-header">
              <h3>ğŸ’¬ Student Inquiries</h3>
              <select class="flt-select" id="fltStage" onchange="loadInquiries(1)">
                <option value="all">All Stages</option>
                <option value="1">ğŸŒ± Foundation</option>
                <option value="2">ğŸ” Development</option>
                <option value="3">ğŸ¯ Strategic</option>
                <option value="4">ğŸ“ Undergraduate</option>
                <option value="5">ğŸ”¬ Masters</option>
                <option value="6">ğŸ›ï¸ Doctoral</option>
                <option value="7">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Parent</option>
              </select>
              <select class="flt-select" id="fltLang" onchange="loadInquiries(1)">
                <option value="all">All Languages</option>
                <option value="en">ğŸ‡¬ğŸ‡§ English</option>
                <option value="bn">ğŸ‡§ğŸ‡© à¦¬à¦¾à¦‚à¦²à¦¾</option>
              </select>
              <button class="top-btn" onclick="loadInquiries(curPage)">
                <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
                Refresh
              </button>
            </div>
            <table class="inq-table">
              <thead><tr><th>FIRST MESSAGE</th><th>STAGE</th><th>LANG</th><th>TIME</th></tr></thead>
              <tbody id="inqBody"><tr><td colspan="4" class="empty-cell">Loading...</td></tr></tbody>
            </table>
            <div class="pagination" id="pgBar"></div>
          </div>
        </div>

      </div><!-- /content -->
    </div><!-- /main -->
  </div><!-- /layout -->
</div><!-- /dashboard -->

<div id="toast"></div>

<script>
  let token   = localStorage.getItem('pa_admin_token') || '';
  let curTab  = 'overview';
  let curPage = 1;

  const STAGE_NAMES = {
    1:'ğŸŒ± Foundation',2:'ğŸ” Development',3:'ğŸ¯ Strategic',
    4:'ğŸ“ Undergraduate',5:'ğŸ”¬ Masters',6:'ğŸ›ï¸ Doctoral',7:'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Parent',unknown:'â€”'
  };

  // â”€â”€ Login â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function doLogin() {
    const pw  = document.getElementById('pwInput').value;
    const err = document.getElementById('loginErr');
    err.style.display = 'none';
    try {
      const r = await fetch('/api/admin/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({password:pw})});
      const d = await r.json();
      if (d.success) {
        token = d.token;
        localStorage.setItem('pa_admin_token', token);
        openDashboard();
      } else { err.style.display='block'; }
    } catch { err.style.display='block'; err.textContent='âš ï¸ Connection error.'; }
  }

  function doLogout() {
    token=''; localStorage.removeItem('pa_admin_token');
    document.getElementById('dashboard').style.display='none';
    document.getElementById('loginScreen').style.display='flex';
    document.getElementById('pwInput').value='';
  }

  function openDashboard() {
    document.getElementById('loginScreen').style.display='none';
    document.getElementById('dashboard').style.display='block';
    loadStats();
    setInterval(loadStats, 60000);
  }

  // â”€â”€ API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function callApi(url) {
    const r = await fetch(url,{headers:{'x-admin-token':token}});
    if (r.status===401){doLogout();return null;}
    return r.json();
  }

  // â”€â”€ Stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadStats() {
    const d = await callApi('/api/admin/stats');
    if (!d) return;
    document.getElementById('sTotal').textContent = d.total.toLocaleString();
    document.getElementById('sToday').textContent = d.today.toLocaleString();
    document.getElementById('sEn').textContent    = d.totalEn.toLocaleString();
    document.getElementById('sBn').textContent    = d.totalBn.toLocaleString();

    // Bar chart
    const maxV = Math.max(...d.daily.map(x=>x.count),1);
    document.getElementById('barWrap').innerHTML = d.daily.map(x=>`
      <div class="bar-item">
        <div class="bar-fill" style="height:${Math.max((x.count/maxV)*100,2)}%">
          <div class="bar-tip">${x.date}: ${x.count}</div>
        </div>
      </div>`).join('');
    document.getElementById('barLabels').innerHTML = d.daily.map(x=>`
      <div class="bar-lbl">${x.date.slice(3)}</div>`).join('');

    // Stage list
    const maxS = Math.max(...(d.stageBreakdown.map(s=>s.count)),1);
    document.getElementById('stageList').innerHTML = d.stageBreakdown.length
      ? d.stageBreakdown.map(s=>`
        <div class="stage-item">
          <div class="si-name">${s.name}</div>
          <div class="si-bar"><div class="si-fill" style="width:${(s.count/maxS)*100}%"></div></div>
          <div class="si-count">${s.count}</div>
        </div>`).join('')
      : '<div style="color:var(--text2);font-size:12px;text-align:center;padding:20px">No data yet â€” start chatting!</div>';
  }

  // â”€â”€ Inquiries â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadInquiries(page) {
    curPage = page;
    const stage = document.getElementById('fltStage').value;
    const lang  = document.getElementById('fltLang').value;
    const body  = document.getElementById('inqBody');
    body.innerHTML = '<tr><td colspan="4" class="empty-cell"><div class="loader"><div class="spin"></div>Loading...</div></td></tr>';

    const d = await callApi(`/api/admin/inquiries?page=${page}&stage=${stage}&lang=${lang}`);
    if (!d) return;

    if (!d.inquiries.length) {
      body.innerHTML = '<tr><td colspan="4" class="empty-cell">No inquiries found.</td></tr>';
    } else {
      body.innerHTML = d.inquiries.map(inq=>`
        <tr>
          <td>
            <div class="msg-preview">${esc(inq.preview||'â€”')}</div>
            <div class="msg-id">ID: ${inq.id}</div>
          </td>
          <td><span class="stg-pill">${STAGE_NAMES[inq.stage]||inq.stage}</span></td>
          <td><span class="lang-pill ${inq.lang==='bn'?'bn':''}">${inq.lang==='bn'?'ğŸ‡§ğŸ‡© BN':'ğŸ‡¬ğŸ‡§ EN'}</span></td>
          <td class="time-col">${fmtTime(inq.time)}</td>
        </tr>`).join('');
    }

    // Pagination
    const pg = document.getElementById('pgBar');
    pg.innerHTML = '';
    if (d.pages > 1) {
      addPgBtn(pg,'â† Prev', page===1, ()=>loadInquiries(page-1));
      for(let i=Math.max(1,page-2);i<=Math.min(d.pages,page+2);i++){
        addPgBtn(pg,i,false,()=>loadInquiries(i),i===page);
      }
      addPgBtn(pg,'Next â†’', page>=d.pages, ()=>loadInquiries(page+1));
    }
  }
  function addPgBtn(container,label,disabled,fn,active=false){
    const b=document.createElement('button');
    b.className='pg-btn'+(active?' active':'');
    b.textContent=label;b.disabled=disabled;b.onclick=fn;
    container.appendChild(b);
  }

  // â”€â”€ Nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function switchTab(name, btn) {
    curTab = name;
    document.getElementById('tabOverview').style.display   = name==='overview'  ?'':'none';
    document.getElementById('tabInquiries').style.display  = name==='inquiries' ?'':'none';
    document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
    if(btn) btn.classList.add('active');
    document.getElementById('topbarTitle').textContent = name==='overview'?'Overview':'Student Inquiries';
    if(name==='inquiries') loadInquiries(1);
  }

  function refreshAll() {
    loadStats();
    if(curTab==='inquiries') loadInquiries(curPage);
    toast('âœ… Refreshed');
  }

  async function doReset() {
    if(!confirm('âš ï¸ Delete ALL inquiry data? This cannot be undone.')) return;
    const r = await fetch('/api/admin/reset',{method:'POST',headers:{'x-admin-token':token}});
    const d = await r.json();
    if(d.success){toast('ğŸ—‘ï¸ Data cleared');loadStats();if(curTab==='inquiries')loadInquiries(1);}
  }

  // â”€â”€ Utils â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function esc(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}
  function fmtTime(iso){
    if(!iso)return'â€”';
    const d=new Date(iso);
    return d.toLocaleDateString('en-GB',{day:'2-digit',month:'short'})+' '+
           d.toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit'});
  }
  function toast(msg){
    const t=document.getElementById('toast');
    t.textContent=msg;t.style.display='block';
    setTimeout(()=>t.style.display='none',2500);
  }

  // Auto-login if token exists
  if(token){
    callApi('/api/admin/stats').then(d=>{
      if(d) openDashboard();
      else{token='';localStorage.removeItem('pa_admin_token');}
    });
  }
</script>
</body>
</html>
